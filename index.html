<!DOCTYPE html>
<html>

<head>
  <title>Location Based AR</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    #cameraPermission {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      text-align: center;
      font-size: 24px;
      justify-content: center;
      align-items: center;
    }

    #sensorValues {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 10px;
      font-size: 16px;
    }

    #button {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 10px;
      font-size: 16px;
    }
  </style>
</head>

<body style="margin: 0; overflow: hidden;">
  <div id="cameraPermission">Lütfen cihazınızı 30 derece üzerinde tutun</div>
  <div id="sensorValues">Alpha: 0<br>Beta: 0<br>Gamma: 0</div>
  <div id="button"><button onclick="location.href='ocr.html'">Go to OCR Page</button></div>
  <a-scene embedded arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;" vr-mode-ui="enabled: false" id="arScene" style="display: none;">
    <a-box material="color: yellow" gps-new-entity-place="latitude: 37.425717; longitude: 31.852222;" position="0 30 0" scale="100 100 100" maxDistance="5000"></a-box>
    <a-entity gps-new-entity-place="latitude: 37.425717; longitude: 31.852222;" text="value: Test; color: red;" scale="50 50 50" maxDistance="5000"></a-entity>
  </a-scene>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const arScene = document.getElementById('arScene');
      const cameraPermission = document.getElementById('cameraPermission');
      const sensorValues = document.getElementById('sensorValues');

      const targetDirection = 0;

      function handleOrientation(event) {
        const beta = event.beta;
        const gamma = event.gamma;
        const alpha = event.alpha;

        sensorValues.innerHTML = `Alpha: ${alpha.toFixed(2)}<br>Beta: ${beta.toFixed(2)}<br>Gamma: ${gamma.toFixed(2)}`;

        if (beta > 30) {
          arScene.style.display = 'block';
          cameraPermission.style.display = 'none';
        } else {
          arScene.style.display = 'none';
          cameraPermission.style.display = 'flex';
        }
      }

      function requestPermission() {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
          DeviceMotionEvent.requestPermission()
            .then(permissionState => {
              if (permissionState === 'granted') {
                window.addEventListener('deviceorientation', handleOrientation);
              } else {
                alert('Permission denied');
              }
            })
            .catch(console.error);
        } else {
          window.addEventListener('deviceorientation', handleOrientation);
        }

        if (typeof navigator.geolocation !== 'undefined') {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              console.log('Geolocation permission granted');
            },
            (error) => {
              alert('Geolocation permission denied');
              console.error(error);
            }
          );
        }
      }

      requestPermission();
    });
  </script>
</body>

</html>
