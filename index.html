<!DOCTYPE html>
<html>

<head>
    <title>Jiroskop ve Bluetooth Verileri</title>
    <style>
        #data {
            font-size: 20px;
            margin: 20px;
        }
    </style>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
</head>

<body>
    <a-scene vr-mode-ui="enabled: false" embedded
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>

        <a-entity gps-entity-place="latitude: 44.4908615; longitude: 11.3326416;"
            gltf-model="./assets/magnemite/scene.gltf" rotation="0 180 0" animation-mixer scale="0.15 0.15 0.15" />
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>
    <div id="data">
        <p>Alfa: <span id="alpha">0</span></p>
        <p>Beta: <span id="beta">0</span></p>
        <p>Gamma: <span id="gamma">0</span></p>
        <p>Bluetooth Sinyal Gücü: <span id="rssi">Bağlanmadı</span></p>

    </div>
    <button id="connectBluetooth">Bluetooth Cihazına Bağlan</button>
    <script>

        window.addEventListener('deviceorientation', function (event) {

            const alpha = event.alpha;
            const beta = event.beta;
            const gamma = event.gamma;

            // Değerleri ekranda güncelleyin
            document.getElementById('alpha').textContent = alpha.toFixed(2);
            document.getElementById('beta').textContent = beta.toFixed(2);
            document.getElementById('gamma').textContent = gamma.toFixed(2);


            if (beta >= 75) {
                startCamera();
            } else {
                stopCamera();
            }
        });





        function stopCamera() {
            const video = document.getElementById('video');
            if (video.srcObject) {
                let stream = video.srcObject;
                let tracks = stream.getTracks();

                tracks.forEach(function (track) {
                    track.stop();
                });

                video.srcObject = null;
                video.style.display = 'none';
            }
        }


        document.getElementById('connectBluetooth').addEventListener('click', function () {
            navigator.bluetooth.requestDevice({ acceptAllDevices: true })
                .then(device => {
                    console.log('Bağlandı: ' + device.name);
                    return device.gatt.connect();
                })
                .then(server => {

                    return server.getPrimaryService('battery_service');
                })
                .then(service => {
                    return service.getCharacteristic('battery_level');
                })
                .then(characteristic => {
                    return characteristic.readValue();
                })
                .then(value => {

                    let rssi = value.getInt8(0);
                    document.getElementById('rssi').textContent = rssi + ' dBm';
                })
                .catch(error => {
                    console.error('Bluetooth bağlantısı başarısız: ', error);
                });
        });
    </script>
</body>

</html>