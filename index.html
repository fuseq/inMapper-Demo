<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Compass with Three.js and AR.js</title>
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- AR.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ar.js"></script>
    <!-- A-Frame CDN (required for AR.js) -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <!-- AR.js ile AR kamera -->
    <script>
        // AR.js ile AR kamera ayarları
        AFRAME.registerComponent('ar-tracking', {
            init: function () {
                this.markerFound = false;
                this.camera = document.querySelector('[gps-camera]');
                this.scene = this.el.sceneEl.object3D;

                // Yön oku için animasyonlu 3D ok modeli oluştur
                const arrowGeometry = new THREE.ConeGeometry(0.1, 0.5, 32);
                const arrowMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
                this.arrowModel = new THREE.Mesh(arrowGeometry, arrowMaterial);
                this.arrowModel.rotation.x = Math.PI / 2; // Yatay düzlemde
                this.arrowModel.scale.set(0.5, 0.5, 0.5); // Boyut ayarı
                this.scene.add(this.arrowModel);

                // Beta açısını kontrol etmek için cihazın döndürme sensörünü kullan
                window.addEventListener('deviceorientation', (event) => {
                    let beta = event.beta;   // Beta açısı (eğim açısı)
                    let gamma = event.gamma; // Gamma açısı (yatay düzlemdeki eğim)

                    // Beta açısı 75 derecenin üzerindeyse AR kamerayı aç
                    if (beta > 75 && !this.markerFound) {
                        this.camera.setAttribute('gps-camera', 'enabled', true);
                        this.markerFound = true;
                    } else if (beta <= 75 && this.markerFound) {
                        this.camera.setAttribute('gps-camera', 'enabled', false);
                        this.markerFound = false;
                    }

                    // Yön okunun yönünü gamma açısına göre ayarla
                    if (gamma !== null && gamma !== undefined) {
                        let angle = gamma * Math.PI / 180; // Radyan cinsinden açıya dönüştür
                        this.arrowModel.rotation.z = -angle; // Z ekseni etrafında dönme
                    }
                });
            }
        });
    </script>

    <!-- AR içerik gösterilecek alan -->
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
        <!-- AR kamera -->
        <a-camera gps-camera rotation-reader ar-tracking></a-camera>

        <!-- AR markerı veya AR hedefi -->
        <!-- Burada genellikle bir GPS koordinatı ile belirtilen bir marker veya hedef kullanılır -->

        <!-- Yön oku için A-Frame entity -->
        <a-entity position="0 0 -2" rotation="90 0 0" scale="0.5 0.5 0.5">
            <a-cone color="red" radius-bottom="0.1" radius-top="0" height="0.5"></a-cone>
        </a-entity>
    </a-scene>
</body>
</html>
